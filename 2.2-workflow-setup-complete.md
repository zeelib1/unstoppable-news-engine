# Workflow Setup Complete ‚úÖ

**Completed:** 2026-01-28 15:50 CET  
**Duration:** 30 minutes  
**Status:** Ready for development

---

## What Was Installed

### 1. Development Tools
```
‚úÖ PHP 8.4.16
‚úÖ Composer 2.9.4  
‚úÖ Node.js v22.22.0 (already installed)
‚úÖ pnpm 10.28.2 (already installed)
```

### 2. Claude Code Agents
**Location:** `/root/ejaj-media/.claude/agents/`

| Agent | Purpose | Model | When Used |
|-------|---------|-------|-----------|
| **planner.md** | Creates implementation plans | Opus | Before coding |
| **tdd-guide.md** | Guides test-driven development | Sonnet | During implementation |
| **code-reviewer.md** | Reviews for quality/security | Opus | After coding |
| **build-error-resolver.md** | Fixes build/test errors | Sonnet | When tests fail |

### 3. Claude Code Commands
**Location:** `/root/ejaj-media/.claude/commands/`

| Command | What It Does |
|---------|--------------|
| `/plan <issue>` | Create detailed implementation plan |
| `/tdd <issue>` | Implement using TDD workflow |
| `/code-review` | Run quality & security review |
| `/verify` | Run full test suite |
| `/commit` | Create proper commit message |
| `/build-fix` | Fix compilation errors |

### 4. Hooks Configuration
**Location:** `/root/ejaj-media/.claude/settings.json`

#### PreToolUse Hooks (Before Actions)
- ‚ùå Block dev servers outside tmux (ensures log access)
- ‚úÖ Run tests before `git push` (prevents broken code)

#### PostToolUse Hooks (After Actions)
- ‚úÖ Auto-format PHP code (php-cs-fixer)
- ‚úÖ Auto-format TypeScript/Vue (prettier)
- ‚ö†Ô∏è Warn about console.log statements

#### SessionStart Hooks
- üìñ Load CLAUDE.md team learnings on startup

### 5. Project Documentation
**Location:** `/root/ejaj-media/CLAUDE.md`

Contains:
- Mistakes to avoid
- Best practices (Laravel + Nuxt)
- Coding style guidelines
- Testing strategy
- File organization
- Git workflow
- PR template
- Security checklist

---

## Workflow Phases

### Phase 1: Plan (5-10 min)
```bash
/plan 103  # Creates detailed implementation plan
```

**Output:**
- Files to create/modify
- Step-by-step breakdown
- Dependencies and risks
- Testing strategy

**Your role:** Review and approve

### Phase 2: Implement (15-30 min)
```bash
/tdd 103  # Implements using TDD
```

**What happens:**
1. Write tests first (RED)
2. Implement code (GREEN)
3. Refactor (IMPROVE)
4. Auto-format code (hooks)
5. Run tests (must pass)
6. Show you working code

### Phase 3: Review (5 min)
```bash
/code-review
```

**Checks:**
- ‚ùå CRITICAL: Hardcoded secrets, SQL injection, XSS
- ‚ö†Ô∏è HIGH: Large functions, missing error handling, no tests
- üí° MEDIUM: Inefficient algorithms, poor naming

### Phase 4: Verify (2-5 min)
```bash
/verify
```

**Runs:**
- PHPUnit (backend tests)
- Vitest (frontend tests)
- E2E test (upload ‚Üí search)
- Coverage check (must be ‚â•80%)

### Phase 5: Commit (1 min)
```bash
/commit
```

**Creates:**
- Proper commit message
- Pushes to GitHub
- Closes issue automatically

---

## Example: Complete Issue Flow

### Issue #103: Create knowledge_bases Migration & Model

```bash
# Step 1: Plan (you approve)
/plan 103

# Step 2: Implement with TDD
/tdd 103
# ‚Üí Tests written
# ‚Üí Code implemented
# ‚Üí Tests pass
# ‚Üí Code auto-formatted

# Step 3: Review
/code-review
# ‚Üí No critical issues
# ‚Üí 1 suggestion (add docblock)

# Step 4: Verify
/verify
# ‚Üí 15/15 tests passed
# ‚Üí Coverage: 87%
# ‚Üí ‚úÖ All checks pass

# Step 5: Commit
/commit
# ‚Üí Committed: "feat(backend): create knowledge_bases migration (#103)"
# ‚Üí Pushed to GitHub
# ‚Üí Issue #103 closed
```

**Time:** ~20-25 minutes  
**Result:** Production-ready, tested code

---

## Testing The Workflow

### Quick Test (5 min)

```bash
cd /root/ejaj-media/api

# 1. Verify Laravel works
php artisan --version
# Should show: Laravel Framework 12.x.x

# 2. Run existing tests (if any)
./vendor/bin/phpunit
# Should show test results

# 3. Create a test migration
php artisan make:migration test_workflow
# Should create migration file

# 4. Check code formatting works
./vendor/bin/php-cs-fixer fix --dry-run
# Should show "No files need fixing" or format issues
```

### Full E2E Test (20 min)

When ready to test the complete workflow:

```bash
# 1. Start new tmux session
tmux new -s askfiles-dev

# 2. In tmux, start backend
cd /root/ejaj-media/api
php artisan serve
# Should run on http://localhost:8000

# 3. New tmux window (Ctrl+b c)
cd /root/ejaj-media/client
pnpm install  # First time only
pnpm dev
# Should run on http://localhost:3000

# 4. Test in browser
open http://localhost:3000
# Should see Nuxt app
```

---

## Next Steps

### Immediate (Now)
1. ‚úÖ Install OpenAI PHP client
   ```bash
   cd /root/ejaj-media/api
   composer require openai-php/laravel
   ```

2. ‚úÖ Verify .env has OpenAI key
   ```bash
   grep OPENAI_API_KEY /root/ejaj-media/api/.env
   # Should show: OPENAI_API_KEY=sk-proj-...
   ```

3. üöÄ Start implementing Issue #103
   ```bash
   /plan 103
   ```

### Today (Next 4-6 hours)
- Issue #103: knowledge_bases migration & model
- Issue #104: document_chunks migration
- Issue #105: OpenAI embeddings service
- Issue #106: Qdrant integration service

### Tomorrow
- Issue #107: Upload endpoint
- Issue #108: Search endpoint
- Frontend implementation
- Deployment

---

## Troubleshooting

### PHP/Composer Issues
```bash
# Check PHP version
php --version
# Should be 8.4+

# Check Composer
composer --version
# Should be 2.9+

# Laravel not found
cd /root/ejaj-media/api
composer install
```

### Hooks Not Running
```bash
# Verify hooks file exists
cat /root/ejaj-media/.claude/settings.json

# Check file permissions
chmod +x /root/ejaj-media/.claude/settings.json
```

### Tests Failing
```bash
# Backend tests
cd /root/ejaj-media/api
./vendor/bin/phpunit --verbose

# Frontend tests  
cd /root/ejaj-media/client
pnpm test:unit
```

---

## Configuration Files Reference

### .claude/settings.json
Hooks configuration - runs automatically before/after tool use

### CLAUDE.md
Team learnings - read this at session start

### .claude/agents/
Specialized agents for different tasks

### .claude/commands/
Slash commands for quick workflows

### .env
Environment variables (OpenAI key, Qdrant config)

---

## Quality Guarantees

With this workflow, every commit has:
- ‚úÖ Tests written (TDD approach)
- ‚úÖ All tests passing
- ‚úÖ Code formatted (consistent style)
- ‚úÖ Security reviewed
- ‚úÖ Coverage ‚â•80%
- ‚úÖ No console.log statements
- ‚úÖ No hardcoded secrets

---

## Time Estimates Per Issue

| Complexity | Plan | Implement | Review | Verify | Total |
|------------|------|-----------|--------|--------|-------|
| **Simple** (migration, model) | 5 min | 10 min | 3 min | 2 min | 20 min |
| **Medium** (service, endpoint) | 10 min | 20 min | 5 min | 5 min | 40 min |
| **Complex** (integration, E2E) | 15 min | 40 min | 10 min | 10 min | 75 min |

**Backend (6 issues):** ~3-4 hours  
**Frontend (5 issues):** ~3-4 hours  
**Total MVP:** ~8 hours (ship tonight!)

---

## Success Criteria

### Backend Complete When:
- [ ] All 6 backend issues closed
- [ ] 80%+ test coverage
- [ ] Can upload PDF via API
- [ ] Can search via API
- [ ] Postman collection works

### Frontend Complete When:
- [ ] All 5 frontend issues closed
- [ ] Upload page functional
- [ ] Search page functional
- [ ] Mobile responsive
- [ ] E2E test passes

### Launch Ready When:
- [ ] Backend + Frontend complete
- [ ] Manual browser test successful
- [ ] No console errors
- [ ] DNS pointed to askfiles.io
- [ ] SSL configured
- [ ] Health check endpoint responds

---

## Resources

- **Workflow Guide:** `/root/clawd/2.1-askfiles-implementation-workflow.md`
- **Team Learnings:** `/root/ejaj-media/CLAUDE.md`
- **Agents:** `/root/ejaj-media/.claude/agents/`
- **Commands:** `/root/ejaj-media/.claude/commands/`
- **Issues:** https://github.com/zeelib1/ejaj-media/issues

---

**Status:** ‚úÖ Workflow Ready  
**Next Command:** `/plan 103`

*Let's ship production-quality code, fast.* üöÄ
